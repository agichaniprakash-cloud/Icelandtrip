<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PERFECT DIGITAL NETWORK – Pending Payments</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --green:#138a55;
    --orange:#f59e0b;
    --muted:#6b6f72;
    --bg:#f6f7f8;
    --card:#fff;
    --radius:10px;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:#1f2933;padding:28px;}
  .wrap{max-width:980px;margin:0 auto}
  header{display:flex;align-items:center;gap:18px;margin-bottom:20px}
  header h1{margin:0;font-size:30px;font-weight:700;color:var(--green)}
  .card{background:var(--card);padding:22px;border-radius:var(--radius);box-shadow:0 8px 20px rgba(9,20,30,0.06)}
  .controls{display:flex;gap:12px;align-items:center;margin-bottom:16px;flex-wrap:wrap}
  input[type=search]{width:100%;max-width:520px;padding:12px;border-radius:8px;border:1px solid #e6e9ea}
  button{background:var(--green);color:white;padding:10px 16px;border:none;border-radius:8px;cursor:pointer}
  button.ghost{background:#fff;color:var(--muted);border:1px solid #e6e9ea}
  table{border-collapse:collapse;width:100%;min-width:700px;margin-top:12px}
  thead th{background:var(--green);color:#fff;padding:16px 12px;text-align:left}
  tbody td{padding:14px 12px;border-bottom:1px solid #f1f2f3}
  .status-paid{background:#d1fae5;color:#065f46;padding:4px 10px;border-radius:8px;font-weight:600;text-transform:capitalize}
  .status-pending{background:#fef3c7;color:#92400e;padding:4px 10px;border-radius:8px;font-weight:600;text-transform:capitalize}
  .formRow{display:flex;flex-direction:column;gap:10px;margin-top:20px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row input,.row select,textarea{flex:1;padding:12px;border-radius:8px;border:1px solid #e6e9ea}
  .actions button{margin-right:6px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>PERFECT DIGITAL NETWORK</h1>
  </header>

  <div class="card">
    <div class="controls">
      <input id="searchBox" type="search" placeholder="Search client, mobile or address" />
      <button id="reloadBtn">Reload</button>
    </div>

    <table id="dataTable">
      <thead>
        <tr>
          <th>Client Name</th>
          <th>Mobile</th>
          <th>Amount (₹)</th>
          <th>Date</th>
          <th>Status</th>
          <th>Address</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="7" style="text-align:center;padding:20px;color:var(--muted)">Loading…</td></tr>
      </tbody>
    </table>

    <hr style="margin:20px 0;border:none;border-top:1px solid #eee" />

    <h2>Add New Client</h2>
    <div class="formRow">
      <div class="row">
        <input id="f_name" placeholder="Client Name">
        <input id="f_mobile" placeholder="Mobile">
      </div>
      <div class="row">
        <input id="f_amount" placeholder="Amount (₹)">
        <input id="f_date" placeholder="Date (DD/MM/YYYY)">
      </div>
      <div class="row">
        <select id="f_status">
          <option>pending</option><option>paid</option>
        </select>
        <input id="f_address" placeholder="Address">
      </div>
      <textarea id="f_remark" rows="2" placeholder="Remark (optional)"></textarea>
      <button id="addBtn">Add Client</button>
      <div id="msg" style="margin-top:8px;color:var(--muted)"></div>
    </div>
  </div>
</div>

<script>
const API='https://sheetdb.io/api/v1/zla8gcygz4jgd';
let rows=[];

async function load(){
  const tb=document.getElementById('tableBody');
  tb.innerHTML='<tr><td colspan="7" style="text-align:center;padding:20px;color:#999">Loading…</td></tr>';
  try{
    const r=await fetch(API);const j=await r.json();rows=j;render();
  }catch(e){tb.innerHTML='<tr><td colspan="7" style="text-align:center;color:#c33">Error '+e.message+'</td></tr>';}
}

function render(){
  const q=document.getElementById('searchBox').value.trim().toLowerCase();
  const tb=document.getElementById('tableBody');tb.innerHTML='';
  const data=rows.filter(r=>Object.values(r).join(' ').toLowerCase().includes(q));
  for(const r of data){
    const tr=document.createElement('tr');
    const status=(r.status||'').toLowerCase();
    tr.innerHTML=`
      <td>${r.clientname||r['Client Name']||''}</td>
      <td>${r.mobile||''}</td>
      <td>${r.amount||''}</td>
      <td>${r.date||''}</td>
      <td><span class="${status==='paid'?'status-paid':'status-pending'}">${status}</span></td>
      <td>${r.address||r.remark||''}</td>
      <td class="actions">
        <button onclick='editRow(${JSON.stringify(JSON.stringify(r))})'>Edit</button>
        <button onclick='deleteRow(${JSON.stringify(JSON.stringify(r))})'>Delete</button>
      </td>`;
    tb.appendChild(tr);
  }
  if(!data.length)tb.innerHTML='<tr><td colspan="7" style="text-align:center;padding:20px;color:#999">No records found</td></tr>';
}

async function addRow(){
  const name=f_name.value.trim(),mobile=f_mobile.value.trim(),amount=f_amount.value.trim(),date=f_date.value.trim(),status=f_status.value.trim(),address=f_address.value.trim(),remark=f_remark.value.trim();
  if(!name){alert('Name required');return;}
  const obj={clientname:name,mobile,amount,date,status,address,remark};
  await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({data:[obj]})});
  msg.textContent='Added ✔';setTimeout(()=>msg.textContent='',2000);
  ['f_name','f_mobile','f_amount','f_date','f_address','f_remark'].forEach(id=>document.getElementById(id).value='');
  load();
}

async function deleteRow(encoded){
  if(!confirm('Delete this client?'))return;
  const r=JSON.parse(encoded);
  const url=API+'/?clientname='+encodeURIComponent(r.clientname||r['Client Name']||'');
  await fetch(url,{method:'DELETE'});
  load();
}

async function editRow(encoded){
  const r=JSON.parse(encoded);
  const newAmt=prompt('New amount for '+(r.clientname||r['Client Name']),r.amount||'');
  const newStatus=prompt('Status (paid/pending)',r.status||'');
  const newAddr=prompt('Address',r.address||r.remark||'');
  const patch={amount:newAmt,status:newStatus,address:newAddr};
  const url=API+'/?clientname='+encodeURIComponent(r.clientname||r['Client Name']||'');
  await fetch(url,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({data:[patch]})});
  load();
}

searchBox.oninput=render;
reloadBtn.onclick=load;
addBtn.onclick=addRow;
load();
</script>
</body>
</html>
